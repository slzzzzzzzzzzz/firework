<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ‰‹æœºçƒŸèŠ±æ¨¡æ‹Ÿå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0c0c2e 0%, #1a1a3e 100%);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .container {
            text-align: center;
            padding: 15px;
            z-index: 10;
            width: 100%;
            max-width: 500px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(to right, #ffb6c1, #f0e68c, #c0c0c0, #aec6cf);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            padding: 0 10px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            margin-bottom: 20px;
            color: #b0b0d0;
            padding: 0 10px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 400px;
            padding: 0 10px;
        }
        
        .color-btn {
            padding: 15px 10px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }
        
        .color-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .color-btn i {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        #lightPink {
            background-color: #ffb6c1;
            color: #8a3a4a;
        }
        
        #gold {
            background-color: #ffd700;
            color: #8a6700;
        }
        
        #silver {
            background-color: #c0c0c0;
            color: #505050;
        }
        
        #lightBlue {
            background-color: #aec6cf;
            color: #3a5a6a;
        }
        
        #random {
            background: linear-gradient(45deg, #ffb6c1, #ffd700, #c0c0c0, #aec6cf);
            color: #333;
            grid-column: span 2;
        }
        
        .fireworks-info {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            width: 100%;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            padding: 0 15px;
            z-index: 10;
        }
        
        .particle-count {
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }
        
        .fireworks-count {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .mobile-tap-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: auto;
        }
        
        /* é˜²æ­¢é•¿æŒ‰èœå• */
        .color-btn, .mobile-tap-area {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* é’ˆå¯¹å°å±å¹•çš„é¢å¤–è°ƒæ•´ */
        @media (max-width: 350px) {
            h1 {
                font-size: 1.6rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            #random {
                grid-column: span 1;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼è°ƒæ•´ */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                padding-top: 5px;
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            .subtitle {
                display: none;
            }
            
            .controls {
                grid-template-columns: repeat(5, 1fr);
                max-width: 100%;
                gap: 8px;
            }
            
            #random {
                grid-column: span 1;
            }
            
            .color-btn {
                padding: 8px 5px;
                min-height: 50px;
                font-size: 0.8rem;
            }
            
            .fireworks-info {
                display: none;
            }
            
            .instructions {
                bottom: 5px;
                font-size: 0.7rem;
            }
        }
        
        /* é˜²æ­¢iPhoneXç­‰è®¾å¤‡çš„åˆ˜æµ·å’ŒHomeæŒ‡ç¤ºå™¨é®æŒ¡ */
        .safe-area-top {
            padding-top: constant(safe-area-inset-top);
            padding-top: env(safe-area-inset-top);
        }
        
        .safe-area-bottom {
            padding-bottom: constant(safe-area-inset-bottom);
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ† æ‰‹æœºçƒŸèŠ±æ¨¡æ‹Ÿå™¨ ğŸ†</h1>
        <p class="subtitle">ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®æˆ–ä¸‹æ–¹æŒ‰é’®é‡Šæ”¾çƒŸèŠ±</p>
        
        <div class="controls">
            <button class="color-btn" id="lightPink">
                <i class="fas fa-fire"></i>
                <span>æµ…ç²‰è‰²</span>
            </button>
            <button class="color-btn" id="gold">
                <i class="fas fa-star"></i>
                <span>é‡‘è‰²</span>
            </button>
            <button class="color-btn" id="silver">
                <i class="fas fa-snowflake"></i>
                <span>é“¶è‰²</span>
            </button>
            <button class="color-btn" id="lightBlue">
                <i class="fas fa-gem"></i>
                <span>ç²‰è“è‰²</span>
            </button>
            <button class="color-btn" id="random">
                <i class="fas fa-random"></i>
                <span>éšæœºé¢œè‰²</span>
            </button>
        </div>
        
        <div class="particle-count">
            å½“å‰ç²’å­æ•°: <span id="particleCount" class="fireworks-count">0</span>
        </div>
        
        <div class="fireworks-info">
            <p>åŒ…å«å››ç§é¢œè‰²ï¼šæµ…ç²‰è‰²ã€é‡‘è‰²ã€é“¶è‰²ã€ç²‰è“è‰²çƒŸèŠ±æ•ˆæœã€‚</p>
            <p>ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®é‡Šæ”¾çƒŸèŠ±ï¼Œç‚¹å‡»æŒ‰é’®é‡Šæ”¾å¯¹åº”é¢œè‰²çƒŸèŠ±ã€‚</p>
        </div>
    </div>
    
    <!-- ç§»åŠ¨ç«¯ä¸“ç”¨ç‚¹å‡»åŒºåŸŸ -->
    <div class="mobile-tap-area" id="mobileTapArea"></div>
    
    <canvas id="fireworksCanvas"></canvas>
    
    <div class="instructions">
        è½»è§¦å±å¹•ä»»æ„ä½ç½®é‡Šæ”¾çƒŸèŠ± | åŒå‡»å±å¹•æ¸…é™¤æ‰€æœ‰çƒŸèŠ±
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        const mobileTapArea = document.getElementById('mobileTapArea');
        
        // è®¾ç½®Canvaså°ºå¯¸ä¸ºçª—å£å¤§å°
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        // åˆå§‹è°ƒæ•´Canvaså°ºå¯¸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', function() {
            // è®¾å¤‡æ—‹è½¬åé‡æ–°è°ƒæ•´
            setTimeout(resizeCanvas, 100);
        });
        
        // çƒŸèŠ±é¢œè‰²å®šä¹‰
        const colors = {
            lightPink: {main: '#FFB6C1', light: '#FFE6EB'},
            gold: {main: '#FFD700', light: '#FFF8B0'},
            silver: {main: '#C0C0C0', light: '#F0F0F0'},
            lightBlue: {main: '#AEC6CF', light: '#DAECF2'}
        };
        
        // å½“å‰æ¿€æ´»çš„é¢œè‰²
        let activeColor = colors.lightPink;
        
        // è§¦æ‘¸ç›¸å…³å˜é‡
        let lastTapTime = 0;
        let tapTimeout;
        
        // çƒŸèŠ±ç²’å­ç±»
        class Particle {
            constructor(x, y, color, isExplosion = false) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.015;
                
                // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šæ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´ç²’å­å¤§å°
                const screenFactor = Math.min(window.innerWidth, window.innerHeight) / 1000;
                this.baseSize = isExplosion ? 4 : 2;
                this.size = Math.random() * this.baseSize + this.baseSize * screenFactor;
                
                // çˆ†ç‚¸ç²’å­æœ‰æ›´å¤§çš„åˆå§‹é€Ÿåº¦
                if (isExplosion) {
                    this.speedX = Math.random() * 6 - 3;
                    this.speedY = Math.random() * 6 - 5;
                } else {
                    this.speedX = Math.random() * 3 - 1.5;
                    this.speedY = Math.random() * 3 - 1.5;
                }
                
                // é‡åŠ›æ•ˆæœ
                this.gravity = 0.1;
            }
            
            update() {
                this.speedY += this.gravity;
                this.x += this.speedX;
                this.y += this.speedY;
                this.alpha -= this.decay;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                
                // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šä½¿ç”¨åœ†å½¢å’Œå‘å…‰æ•ˆæœ
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // æ·»åŠ å‘å…‰æ•ˆæœ
                ctx.shadowColor = this.color;
                ctx.shadowBlur = 10 * (this.alpha);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // çƒŸèŠ±ç±»
        class Firework {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.particles = [];
                this.createParticles();
            }
            
            createParticles() {
                // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šæ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´ç²’å­æ•°é‡
                const screenFactor = Math.min(window.innerWidth, window.innerHeight) / 1000;
                const particleCount = Math.floor(60 * screenFactor);
                
                for (let i = 0; i < particleCount; i++) {
                    // äº¤æ›¿ä½¿ç”¨ä¸»è‰²å’Œäº®è‰²
                    const color = i % 2 === 0 ? this.color.main : this.color.light;
                    this.particles.push(new Particle(this.x, this.y, color, true));
                }
            }
            
            update() {
                // æ›´æ–°æ‰€æœ‰ç²’å­
                for (let i = 0; i < this.particles.length; i++) {
                    this.particles[i].update();
                    
                    // ç§»é™¤é€æ˜åº¦ä¸º0çš„ç²’å­
                    if (this.particles[i].alpha <= 0) {
                        this.particles.splice(i, 1);
                        i--;
                    }
                }
            }
            
            draw() {
                // ç»˜åˆ¶æ‰€æœ‰ç²’å­
                for (let particle of this.particles) {
                    particle.draw();
                }
            }
            
            isFinished() {
                return this.particles.length === 0;
            }
        }
        
        // çƒŸèŠ±ç®¡ç†å™¨
        class FireworksManager {
            constructor() {
                this.fireworks = [];
                this.maxFireworks = 15; // ç§»åŠ¨ç«¯é™åˆ¶åŒæ—¶æ˜¾ç¤ºçš„çƒŸèŠ±æ•°é‡
            }
            
            addFirework(x, y, color) {
                // é™åˆ¶åŒæ—¶æ˜¾ç¤ºçš„çƒŸèŠ±æ•°é‡
                if (this.fireworks.length >= this.maxFireworks) {
                    this.fireworks.shift(); // ç§»é™¤æœ€æ—§çš„çƒŸèŠ±
                }
                this.fireworks.push(new Firework(x, y, color));
            }
            
            update() {
                for (let i = 0; i < this.fireworks.length; i++) {
                    this.fireworks[i].update();
                    
                    // ç§»é™¤å·²å®Œæˆçš„çƒŸèŠ±
                    if (this.fireworks[i].isFinished()) {
                        this.fireworks.splice(i, 1);
                        i--;
                    }
                }
            }
            
            draw() {
                for (let firework of this.fireworks) {
                    firework.draw();
                }
            }
            
            clear() {
                this.fireworks = [];
            }
            
            getParticleCount() {
                let count = 0;
                for (let firework of this.fireworks) {
                    count += firework.particles.length;
                }
                return count;
            }
        }
        
        // åˆå§‹åŒ–çƒŸèŠ±ç®¡ç†å™¨
        const fireworksManager = new FireworksManager();
        
        // æ›´æ–°ç²’å­è®¡æ•°å™¨æ˜¾ç¤º
        function updateParticleCount() {
            document.getElementById('particleCount').textContent = fireworksManager.getParticleCount();
        }
        
        // åˆ›å»ºçƒŸèŠ±
        function createFirework(x, y, color) {
            fireworksManager.addFirework(x, y, color);
            
            // æ·»åŠ è§¦è§‰åé¦ˆï¼ˆå¦‚æœè®¾å¤‡æ”¯æŒï¼‰
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            // æ·»åŠ å£°éŸ³æ•ˆæœ
            playFireworkSound();
        }
        
        // æ’­æ”¾çƒŸèŠ±å£°éŸ³æ•ˆæœ
        function playFireworkSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime); // ç§»åŠ¨ç«¯éŸ³é‡è°ƒä½
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // å¦‚æœéŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å¯ç”¨ï¼Œé™é»˜å¤±è´¥
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // æ¸…é™¤ç”»å¸ƒï¼Œä½¿ç”¨åŠé€æ˜é»‘è‰²åˆ›é€ æ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(12, 12, 46, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
            fireworksManager.update();
            fireworksManager.draw();
            
            // æ›´æ–°ç²’å­è®¡æ•°æ˜¾ç¤º
            updateParticleCount();
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            requestAnimationFrame(animate);
        }
        
        // å¯åŠ¨åŠ¨ç”»
        animate();
        
        // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶å¤„ç†
        function handleTap(x, y) {
            createFirework(x, y, activeColor);
            
            // æ·»åŠ ç‚¹å‡»åé¦ˆæ•ˆæœ
            const buttons = document.querySelectorAll('.color-btn');
            buttons.forEach(btn => {
                btn.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 100);
            });
        }
        
        // åŒå‡»æ¸…é™¤æ‰€æœ‰çƒŸèŠ±
        function handleDoubleTap() {
            fireworksManager.clear();
            
            // æ˜¾ç¤ºæ¸…é™¤æç¤º
            const instructions = document.querySelector('.instructions');
            const originalText = instructions.textContent;
            instructions.textContent = "å·²æ¸…é™¤æ‰€æœ‰çƒŸèŠ±";
            instructions.style.color = "#ffd700";
            
            setTimeout(() => {
                instructions.textContent = originalText;
                instructions.style.color = "rgba(255, 255, 255, 0.7)";
            }, 1000);
        }
        
        // è§¦æ‘¸äº‹ä»¶ç›‘å¬
        mobileTapArea.addEventListener('touchstart', function(e) {
            e.preventDefault();
            
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTapTime;
            
            // æ¸…é™¤ä¹‹å‰çš„å•å‡»è¶…æ—¶
            clearTimeout(tapTimeout);
            
            if (tapLength < 300 && tapLength > 0) {
                // åŒå‡»äº‹ä»¶
                handleDoubleTap();
            } else {
                // å•å‡»äº‹ä»¶
                tapTimeout = setTimeout(function() {
                    const touch = e.touches[0] || e.changedTouches[0];
                    handleTap(touch.clientX, touch.clientY);
                }, 200);
            }
            
            lastTapTime = currentTime;
        }, { passive: false });
        
        // é˜²æ­¢è§¦æ‘¸æ—¶æ»šåŠ¨
        mobileTapArea.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼ˆå…¼å®¹éè§¦æ‘¸è®¾å¤‡ï¼‰
        mobileTapArea.addEventListener('click', function(e) {
            handleTap(e.clientX, e.clientY);
        });
        
        // é¢œè‰²æŒ‰é’®äº‹ä»¶ç›‘å¬
        document.getElementById('lightPink').addEventListener('click', (e) => {
            e.stopPropagation();
            activeColor = colors.lightPink;
            createFirework(Math.random() * canvas.width * 0.8 + canvas.width * 0.1, 
                          Math.random() * canvas.height * 0.6 + canvas.height * 0.2, 
                          activeColor);
        });
        
        document.getElementById('gold').addEventListener('click', (e) => {
            e.stopPropagation();
            activeColor = colors.gold;
            createFirework(Math.random() * canvas.width * 0.8 + canvas.width * 0.1, 
                          Math.random() * canvas.height * 0.6 + canvas.height * 0.2, 
                          activeColor);
        });
        
        document.getElementById('silver').addEventListener('click', (e) => {
            e.stopPropagation();
            activeColor = colors.silver;
            createFirework(Math.random() * canvas.width * 0.8 + canvas.width * 0.1, 
                          Math.random() * canvas.height * 0.6 + canvas.height * 0.2, 
                          activeColor);
        });
        
        document.getElementById('lightBlue').addEventListener('click', (e) => {
            e.stopPropagation();
            activeColor = colors.lightBlue;
            createFirework(Math.random() * canvas.width * 0.8 + canvas.width * 0.1, 
                          Math.random() * canvas.height * 0.6 + canvas.height * 0.2, 
                          activeColor);
        });
        
        document.getElementById('random').addEventListener('click', (e) => {
            e.stopPropagation();
            const colorKeys = Object.keys(colors);
            const randomColorKey = colorKeys[Math.floor(Math.random() * colorKeys.length)];
            activeColor = colors[randomColorKey];
            
            // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šç”Ÿæˆ2-3ä¸ªçƒŸèŠ±
            const fireworkCount = Math.floor(Math.random() * 2) + 2;
            for (let i = 0; i < fireworkCount; i++) {
                setTimeout(() => {
                    createFirework(Math.random() * canvas.width * 0.8 + canvas.width * 0.1, 
                                  Math.random() * canvas.height * 0.6 + canvas.height * 0.2, 
                                  activeColor);
                }, i * 100);
            }
        });
        
        // åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿çƒŸèŠ±
        window.addEventListener('load', () => {
            setTimeout(() => {
                createFirework(canvas.width * 0.3, canvas.height * 0.5, colors.lightPink);
            }, 300);
            
            setTimeout(() => {
                createFirework(canvas.width * 0.7, canvas.height * 0.4, colors.gold);
            }, 800);
            
            setTimeout(() => {
                createFirework(canvas.width * 0.5, canvas.height * 0.6, colors.silver);
            }, 1300);
            
            setTimeout(() => {
                createFirework(canvas.width * 0.4, canvas.height * 0.3, colors.lightBlue);
            }, 1800);
        });
        
        // é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });
    </script>
</body>
</html>
